"use strict";(self.webpackChunkACRA_Point_V3_Education=self.webpackChunkACRA_Point_V3_Education||[]).push([[5603],{5593:(r,n,e)=>{e.r(n),e.d(n,{assets:()=>o,contentTitle:()=>s,default:()=>d,frontMatter:()=>l,metadata:()=>a,toc:()=>c});var t=e(5893),i=e(1151);const l={},s="libutool.go",a={type:"mdx",permalink:"/ilovedev/wauth/libutool",source:"@site/src/pages/wauth/libutool.md",title:"libutool.go",description:"libutool\uc740 util\ud568\uc218. \ubaa8\ub4e0 Repositories\uc5d0\uc11c \uc0ac\uc6a9\ud568",frontMatter:{},unlisted:!1},o={},c=[{value:"enc.go",id:"encgo",level:3},{value:"file.go",id:"filego",level:3},{value:"error.go",id:"errorgo",level:3}];function h(r){const n={code:"code",h1:"h1",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...r.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"libutoolgo",children:"libutool.go"}),"\n",(0,t.jsx)(n.p,{children:"libutool\uc740 util\ud568\uc218. \ubaa8\ub4e0 Repositories\uc5d0\uc11c \uc0ac\uc6a9\ud568"}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.h3,{id:"encgo",children:"enc.go"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\ubaa8\ub4e0 \uc554\ud638\ud654 \ud568\uc218\ub294 \uad6d\uac00\uc6a9 \ubcf4\uc548\uc694\uad6c\uc0ac\ud56d 3\ub97c \ub530\ub984(CC\uc778\uc99d)"}),"\n",(0,t.jsxs)(n.li,{children:["salt \uc0dd\uc131 \ud568\uc218","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"pbkdf2\ub97c \ud638\ucd9c \ud560\ub54c \uc0ac\uc6a9"}),"\n",(0,t.jsxs)(n.li,{children:["Salt()","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func Salt(size int) ([]byte, error) {\r\n\r\n  seed := make([]byte, MaxEntropyBytes)\r\n  _, err := rand.Read(seed)\r\n  if err != nil {\r\n      return []byte{}, ErrorStack(err)\r\n  }\r\n\r\n  rng, err := NewHmacDrbg(256, seed, nil)\r\n  if err != nil {\r\n      return []byte{}, ErrorStack(err)\r\n  }\r\n\r\n  gen := make([]byte, size)\r\n  rd := NewHmacDrbgReader(rng)\r\n  _, err = rd.Read(gen)\r\n  if err != nil {\r\n      return []byte{}, ErrorStack(err)\r\n  }\r\n\r\n  // \uad6d\uac00\uc6a9 \ubcf4\uc548\uc694\uad6c\uc0ac\ud56d V3 : \uba54\ubaa8\ub9ac \ub36e\uc5b4\uc4f0\uae30\r\n  for _, v := range []byte{0, 0, 0, 0, 0} {\r\n      for i := 0; i < len(gen); i++ {\r\n          gen[i] = v\r\n      }\r\n      for i := 0; i < len(seed); i++ {\r\n          seed[i] = v\r\n      }\r\n  }\r\n\r\n  return gen, nil\r\n}\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["AES256 CTR \ubcf5\ud638\ud654 \ud568\uc218","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["DecodeBase64AndAES256CTRDecrypt()","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'func DecodeBase64AndAES256CTRDecrypt(key string, data string) ([]byte, error) {\r\n\r\n  ciphertext, err := base64.StdEncoding.DecodeString(data)\r\n  if err != nil {\r\n      return []byte{}, err\r\n  }\r\n\r\n  block, err := aes.NewCipher([]byte(key))\r\n  if err != nil {\r\n      return []byte{}, err\r\n  }\r\n\r\n  if len(ciphertext) < aes.BlockSize {\r\n      return []byte{}, ErrorStack(fmt.Errorf("ciphertext too short"), "E_DEFT_0000")\r\n  }\r\n\r\n  // Extract the IV from the ciphertext\r\n  iv := ciphertext[:aes.BlockSize]\r\n  ciphertext = ciphertext[aes.BlockSize:]\r\n\r\n  stream := cipher.NewCTR(block, iv)\r\n\r\n  plaintext := make([]byte, len(ciphertext))\r\n  stream.XORKeyStream(plaintext, ciphertext)\r\n\r\n  // \uad6d\uac00\uc6a9 \ubcf4\uc548\uc694\uad6c\uc0ac\ud56d V3 : \uba54\ubaa8\ub9ac \ub36e\uc5b4\uc4f0\uae30\r\n  for _, v := range []byte{0, 0, 0, 0, 0} {\r\n      for i := 0; i < len(iv); i++ {\r\n          iv[i] = v\r\n      }\r\n      for i := 0; i < len(ciphertext); i++ {\r\n          ciphertext[i] = v\r\n      }\r\n      key = strings.Repeat(fmt.Sprintf("%v", v), len(key))\r\n  }\r\n\r\n  return plaintext, nil\r\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\ud574\uc2dc\uac12 \uc0dd\uc131 \ud568\uc218","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Pbkdf2Hash64()","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func Pbkdf2Hash64(data []byte) (string, error) {\r\n    salt, _ := Salt(SaltSize)\r\n    key := pbkdf2.Key([]byte(data), salt, 1000, 32, sha256.New)\r\n\r\n    hash := append(key, salt...)\r\n    hash64 := base64.StdEncoding.EncodeToString(hash)\r\n\r\n    // \uad6d\uac00\uc6a9 \ubcf4\uc548\uc694\uad6c\uc0ac\ud56d V3 : \uba54\ubaa8\ub9ac \ub36e\uc5b4\uc4f0\uae30\r\n    for _, v := range []byte{0, 0, 0, 0, 0} {\r\n        for i := 0; i < len(key); i++ {\r\n            key[i] = v\r\n        }\r\n        for i := 0; i < len(salt); i++ {\r\n            salt[i] = v\r\n        }\r\n    }\r\n\r\n    return hash64, nil\r\n}\n"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\ud574\uc2dc\uac12 \ube44\uad50 \ud568\uc218","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["ComparePbkdf2Hash64()","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'func ComparePbkdf2Hash64(data []byte, hash64 string) error {\r\n    hash, err := base64.StdEncoding.DecodeString(hash64)\r\n    if err != nil {\r\n        return err\r\n    }\r\n\r\n    if len(hash) != 32+SaltSize {\r\n        return fmt.Errorf("the length of hash must be 48")\r\n    }\r\n    _ = hash[:len(hash)-SaltSize]\r\n    salt := hash[len(hash)-SaltSize:]\r\n\r\n    key := pbkdf2.Key([]byte(data), salt, 1000, 32, sha256.New)\r\n    rehash := append(key, salt...)\r\n\r\n    if !bytes.Equal(hash, rehash) {\r\n        return fmt.Errorf("not equal")\r\n    }\r\n\r\n    // \uad6d\uac00\uc6a9 \ubcf4\uc548\uc694\uad6c\uc0ac\ud56d V3 : \uba54\ubaa8\ub9ac \ub36e\uc5b4\uc4f0\uae30\r\n    for _, v := range []byte{0, 0, 0, 0, 0} {\r\n        for i := 0; i < len(key); i++ {\r\n            key[i] = v\r\n        }\r\n        for i := 0; i < len(salt); i++ {\r\n            salt[i] = v\r\n        }\r\n    }\r\n\r\n    return nil\r\n}\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.h3,{id:"filego",children:"file.go"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\ud574\ub2f9 \uacbd\ub85c\uc5d0 \ud30c\uc77c\uc774 \uc788\ub294\uc9c0 \ud655\uc778\ud558\ub294 \ud568\uc218","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:"func IsFile(path string) bool {\r\n    if st, err := os.Stat(path); err == nil {\r\n        return !st.IsDir()\r\n    }\r\n    return false\r\n}\n"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.h3,{id:"errorgo",children:"error.go"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\uc544\ub798\uc640 \uac19\uc774 ErrorStack\uc744 \uc0ac\uc6a9\ud558\uc5ec \uae30\ubcf8 Error\uc5d0 \ucd94\uac00 \uc815\ubcf4\ub97c \ub354\ud568"}),"\n",(0,t.jsxs)(n.li,{children:["ErrorStack()","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'func ErrorStack(err interface{}, param ...interface{}) error {\r\n    _, fn, line, _ := runtime.Caller(1)\r\n    f := path.Base(fn)\r\n    f = strings.TrimSuffix(f, ".go")\r\n\r\n    le := LineError{Timestamp: time.Now().Unix(), File: f, Line: line}\r\n    switch terr := err.(type) {\r\n    case string:\r\n        var note string\r\n        if len(param) > 0 {\r\n            note = fmt.Sprintf(terr, param...)\r\n        } else {\r\n            note = terr\r\n        }\r\n        note = strings.TrimSpace(note)\r\n\r\n        le.Err = nil\r\n        le.Note = note\r\n\r\n    case error:\r\n        var note string\r\n        if len(param) > 0 {\r\n            note = fmt.Sprintf(fmt.Sprintf("%v", param[0]), param[1:]...)\r\n        }\r\n        note = strings.TrimSpace(note)\r\n\r\n        le.Err = terr\r\n        le.Note = note\r\n\r\n    case nil:\r\n        var note string\r\n        if len(param) > 0 {\r\n            note = fmt.Sprintf(fmt.Sprintf("%v", param[0]), param[1:]...)\r\n        }\r\n        note = strings.TrimSpace(note)\r\n\r\n        le.Err = nil\r\n        le.Note = note\r\n    }\r\n\r\n    return &le\r\n}\n'})}),"\n"]}),"\n"]})]})}function d(r={}){const{wrapper:n}={...(0,i.a)(),...r.components};return n?(0,t.jsx)(n,{...r,children:(0,t.jsx)(h,{...r})}):h(r)}},1151:(r,n,e)=>{e.d(n,{Z:()=>a,a:()=>s});var t=e(7294);const i={},l=t.createContext(i);function s(r){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof r?r(n):{...n,...r}}),[n,r])}function a(r){let n;return n=r.disableParentContext?"function"==typeof r.components?r.components(i):r.components||i:s(r.components),t.createElement(l.Provider,{value:n},r.children)}}}]);