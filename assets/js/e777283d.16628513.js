"use strict";(self.webpackChunkACRA_Point_V3_Education=self.webpackChunkACRA_Point_V3_Education||[]).push([[2632],{801:(r,n,e)=>{e.r(n),e.d(n,{assets:()=>i,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var t=e(5893),o=e(1151);const s={},a="Manager",c={type:"mdx",permalink:"/ilovedev/wauth/manager",source:"@site/src/pages/wauth/manager.md",title:"Manager",description:"manager.Create()",frontMatter:{},unlisted:!1},i={},l=[{value:"manager.Create()",id:"managercreate",level:3}];function f(r){const n={code:"code",h1:"h1",h3:"h3",li:"li",pre:"pre",ul:"ul",...(0,o.a)(),...r.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"manager",children:"Manager"}),"\n",(0,t.jsx)("br",{}),"\n",(0,t.jsx)(n.h3,{id:"managercreate",children:"manager.Create()"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Create \ud568\uc218 \ud638\ucd9c","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'err := adminMgr.Create(r.Context(), req, "Base")\r\nif err != nil {\r\n\tlogging.Errorln(err)\r\n}\n'})}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Create \ud568\uc218","\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-go",children:'func (m *AdminManager) Create(ctx context.Context, person info.Admin, Regulation string) (error) {\r\n    var err error\r\n\r\n    // \uac80\uc0ac: \ube44\ubc00\ubc88\ud638\uac00 \uc5c6\uc73c\uba74 \uc624\ub958\r\n    if len(person.Password) <= 0 {\r\n        err = fmt.Errorf("\uc0dd\uc131\uc2dc \ube44\ubc00\ubc88\ud638 empty")\r\n        return tool.ErrorStack(err, "E_ADMN_0020")\r\n    }\r\n\r\n    // \uac80\uc0ac: \uc544\uc774\ub514\ub294 \ud544\uc218\r\n    if len(person.ID) <= 0 {\r\n        err = fmt.Errorf("\uc544\uc774\ub514\ub294 \ud544\uc218")\r\n        return tool.ErrorStack(err, "E_TPOL_0001")\r\n    }\r\n\r\n    // \uac80\uc0ac: \uc544\uc774\ub514 \ud55c\uae00\uc0ac\uc6a9 \ubd88\uac00\r\n    if tool.IsKoreanString(person.ID) {\r\n        err = fmt.Errorf("\uc544\uc774\ub514\ub294 \ud55c\uae00\uc0ac\uc6a9 \ubd88\uac00")\r\n        return tool.ErrorStack(err, "E_ADMN_0030")\r\n    }\r\n\r\n    // \uac80\uc0ac: \uc544\uc774\ub514\ub294 \ubb38\uc790\uc640 \uc22b\uc790\ub9cc \uac00\ub2a5\r\n    for _, char := range person.ID {\r\n        if !unicode.IsLetter(char) && !unicode.IsNumber(char) {\r\n            err = fmt.Errorf("\uc544\uc774\ub514\ub294 \ubb38\uc790\uc640 \uc22b\uc790\ub9cc \uac00\ub2a5")\r\n            return tool.ErrorStack(err, "E_VLPW_0027")\r\n        }\r\n    }\r\n\r\n    // \uac80\uc0ac: \uc544\uc774\ub514\ub294 255\uc790\ub9ac \uc81c\ud55c\r\n    if len(person.ID) >= 255 {\r\n        err = fmt.Errorf("\uc544\uc774\ub514\ub294 255\uc790\ub9ac \uc774\uc0c1 \uae08\uc9c0")\r\n        return tool.ErrorStack(err, "E_ADMN_0031")\r\n    }\r\n\r\n    // \uac80\uc0ac: \ud574\ub2f9 ID\uac00 \uc774\ubbf8 \uc788\ub2e4\uba74 \uc624\ub958\r\n    existPerson, err := m.Get(ctx, person.ID)\r\n    if err == nil {\r\n        if existPerson.ID == person.ID {\r\n            err = fmt.Errorf("\ud574\ub2f9 ID\uc758 \uc0ac\uc6a9\uc790\uac00 \uc774\ubbf8 \uc874\uc7ac\ud569\ub2c8\ub2e4.")\r\n            return tool.ErrorStack("E_ADMN_0001")\r\n        }\r\n    }\r\n\r\n    // \ub85c\uc9c1: \ube44\ubc00\ubc88\ud638 \uc554\ud638\ud654\r\n    if len(person.Password) > 0 {\r\n        hash, err := tool.Pbkdf2Hash64([]byte(person.Password))\r\n        if err != nil {\r\n            m.Log.Errorln(err)\r\n            return tool.ErrorStack(err, "E_DEFT_0000")\r\n        }\r\n        person.Password = hash\r\n    }\r\n\r\n    if len(person.OfflineSecret) > 0 {\r\n        offsecret, err := tool.AES256CTREncryptAndEncodeBase64(libconfigkey.GetAESKeyOnce(ctx, m.Log, m.client), []byte(person.OfflineSecret))\r\n        if err != nil {\r\n            m.Log.Errorln(err)\r\n            return tool.ErrorStack(err, "E_DEFT_0000")\r\n        }\r\n        person.OfflineSecret = offsecret\r\n    }\r\n\r\n    if len(person.OnlineSecret) > 0 {\r\n        onsecret, err := tool.AES256CTREncryptAndEncodeBase64(libconfigkey.GetAESKeyOnce(ctx, m.Log, m.client), []byte(person.OnlineSecret))\r\n        if err != nil {\r\n            m.Log.Errorln(err)\r\n            return tool.ErrorStack(err, "E_DEFT_0000")\r\n        }\r\n        person.OnlineSecret = onsecret\r\n    }\r\n\r\n    // \ub85c\uc9c1: \uc720\ud6a8\ud55c ip\uc778\uc9c0 \uac80\uc0ac\r\n    err = CheckIPAddress(person.IPAddresses, Regulation)\r\n    if err != nil {\r\n        return err\r\n    }\r\n\r\n    // \ucd08\uae30\uac12: \uc2e0\uaddc\uc0dd\uc131\uc2dc \ubb34\uc870\uac74 \uac15\uc81c\uc554\ud638\ubcc0\uacbd \uc124\uc815\uc744 ON \uc2dc\ud0a8\ub2e4\r\n    person.ForceChangePwd = bool(info.PERSON_NEED_CHANGE_PASSWORD)\r\n\r\n    // \ucd08\uae30\uac12: \uc0dd\uc131 \uc2dc\uac04\r\n    person.CreateTimestamp = time.Now().Unix()\r\n\r\n    m.Mutex.Lock()\r\n    defer m.Mutex.Unlock()\r\n\r\n    _, err = m.Admin.InsertOne(ctx, person)\r\n    if err != nil {\r\n        m.Log.Errorln(err)\r\n        return tool.ErrorStack(err, "E_DEFT_0000")\r\n    }\r\n\r\n    return nil\r\n}\n'})}),"\n"]}),"\n"]})]})}function d(r={}){const{wrapper:n}={...(0,o.a)(),...r.components};return n?(0,t.jsx)(n,{...r,children:(0,t.jsx)(f,{...r})}):f(r)}},1151:(r,n,e)=>{e.d(n,{Z:()=>c,a:()=>a});var t=e(7294);const o={},s=t.createContext(o);function a(r){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof r?r(n):{...n,...r}}),[n,r])}function c(r){let n;return n=r.disableParentContext?"function"==typeof r.components?r.components(o):r.components||o:a(r.components),t.createElement(s.Provider,{value:n},r.children)}}}]);